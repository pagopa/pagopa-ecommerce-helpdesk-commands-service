openapi: 3.0.0
info:
  version: 2.0.0
  title: Pagopa helpdeskCommands services for assistance api
  description: This microservice that expose helpdeskCommands services for assistance api.
servers:
  - url: https://${host}
tags:
  - name: helpdeskCommands
    description: Api's for performing money refund operations over failed transactions # this will be evolving over time
    externalDocs:
      url: https://pagopa.atlassian.net/wiki/spaces/I/pages/492339720/pagoPA+eCommerce+Design+Review #TODO this needs to be updated
      description: Technical specifications

paths:
  /helpdeskCommands/refund:
    post:
      tags:
        - ecommerce
      operationId: refundOperation
      summary: Api's for performing money refunds operations over failed transactions
      description: 'POST with body payload - no resources created'
      requestBody:
        $ref: "#/components/requestBodies/RefundTransactionRequest"
      responses:
        '200':
          description: Transactions refunded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefundTransactionResponse'
        '400':
          description: Formally invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Transaction not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
components:
  schemas:
    RefundTransactionResponse:
      type: object
      properties:
        refundOperationId:
          type: number
          description: The id of the refunded operation, if any
          default: 0
        result:
          type: string
          description: The short description of the refund status
          default: Ok
        status:
          $ref: '#/components/schemas/HttpStatusCode'
        detail:
          type: string
          description: The detailed description of the refund status
          example: There was an error processing the request
    ProblemJson:
      type: object
      properties:
        type:
          type: string
          format: uri
          description: |-
            An absolute URI that identifies the problem type. When dereferenced,
            it SHOULD provide human-readable documentation for the problem type
            (e.g., using HTML).
          default: about:blank
          example: https://example.com/problem/constraint-violation
        title:
          type: string
          description: |-
            A short, summary of the problem type. Written in english and readable
            for engineers (usually not suited for non technical stakeholders and
            not localized); example: Service Unavailable
        status:
          $ref: '#/components/schemas/HttpStatusCode'
        detail:
          type: string
          description: |-
            A human readable explanation specific to this occurrence of the
            problem.
          example: There was an error processing the request
        instance:
          type: string
          format: uri
          description: |-
            An absolute URI that identifies the specific occurrence of the problem.
            It may or may not yield further information if dereferenced.
    HttpStatusCode:
      type: integer
      format: int32
      description: |-
        The HTTP status code generated by the origin server for this occurrence
        of the problem.
      minimum: 100
      maximum: 600
      exclusiveMaximum: true
      example: 200
    RefundTransactionRequest:
      type: object
      properties:
        transactionId:
          type: number
          description: The id of the transaction
          default: 0
        paymentMethodId:
          type: number
          description: The id of the payment method
          default: 0
        pspId:
          type: number
          description: The id of the psp
          default: 0
        operationId:
          type: number
          description: The id of the operation
          default: 0
        correlationId:
          type: number
          description: The id of the correlation
          default: 0
        amount:
          type: number
          description: The amount to refund
          default: 0
  requestBodies:
    RefundTransactionRequest:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RefundTransactionRequest'
